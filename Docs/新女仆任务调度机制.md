
## 新女仆任务调度机制

### 概述

新任务调度机制的核心是精细化地控制每一个女仆的目标，而实现精细化控制的底层组件则是运行时女仆管理器。

### 基础模块

#### 运行时女仆管理器

在世界运行时，管理当前世界已加载的女仆实体。（下文简称“管理器”）
部分任务不再由女仆自身的定时事件触发，而是由各个总任务调度器从管理器中获取数据，然后再发给对应的女仆执行。

##### 初始化、入队与数据更新

初始化的逻辑很简单，只要遍历世界的所有女仆，并一一加入管理映射就好了。管理映射存储着女仆对应的一些临时数据，并证明着她当前存在于世界。
触发入队或数据更新的时机：
1、管理器初始化
2、女仆生成
3、女仆被驯服
4、工作模式变化

触发离队的时机：
1、在获取该女仆或周期性扫描时，没有找到该女仆
2、女仆被转换为物品或阵亡

##### 女仆目标管理

女仆进入一些模式时，会暂时进入等待安排目标的状态，然后由管理器来安排专属的目标。

为了实现目标实体仅会被唯一女仆锁定，首先需要给女仆的定义json设置足够多的索敌组件，格式如下：

```json
{ "filters": { "test": "int_property", "domain": "thlmt:value", "subject": "other", "value": 9 }, "max_dist": 16 }
```

这样，我们只需要定义一个拥有 `thlmt:value` 属性的实体，然后用脚本来修改它。
女仆方面必须要定义大量索敌组件，目前别无他法，我们可能需要一种 **自动生成女仆json的脚本** 来帮助我们理清逻辑。
希望未来 mojang 能开放接口，使我们能够直接设定目标，并且无视 json 定义的寻路规则。

#### 总任务调度器

部分任务（如耕作）需要持续地、全局地、考虑其他女仆地安排，否则会出现多个女仆聚集在小范围执行相同的任务，导致效率降低。总任务调度器做的则是这样的一件事。
它负责精确地

### 

